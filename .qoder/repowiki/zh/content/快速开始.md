# 快速开始

<cite>
**本文档中引用的文件**   
- [README.md](file://README.md)
- [libs/deepagents/README.md](file://libs/deepagents/README.md)
- [libs/deepagents-cli/README.md](file://libs/deepagents-cli/README.md)
- [libs/deepagents/deepagents/graph.py](file://libs/deepagents/deepagents/graph.py)
- [libs/deepagents/deepagents/middleware/filesystem.py](file://libs/deepagents/deepagents/middleware/filesystem.py)
- [libs/deepagents/deepagents/middleware/subagents.py](file://libs/deepagents/deepagents/middleware/subagents.py)
- [libs/deepagents/deepagents/backends/protocol.py](file://libs/deepagents/deepagents/backends/protocol.py)
- [libs/deepagents-cli/deepagents_cli/main.py](file://libs/deepagents-cli/deepagents_cli/main.py)
</cite>

## 目录
1. [简介](#简介)
2. [核心功能](#核心功能)
3. [安装与配置](#安装与配置)
4. [基础使用](#基础使用)
5. [CLI使用指南](#cli使用指南)
6. [中间件与后端](#中间件与后端)
7. [常见问题](#常见问题)
8. [高级主题](#高级主题)

## 简介

deepagents-langchain 是一个基于 LangGraph 的深度代理框架，旨在解决长周期任务中的成本和可靠性挑战。该项目通过实现规划、文件系统访问和子代理委派等核心原则，为开发者提供了一个开源且可扩展的代理框架。该框架受到 Claude Code、Manus 等流行代理的启发，允许用户通过自定义工具和指令轻松扩展功能。

**Section sources**
- [README.md](file://README.md#L3-L10)

## 核心功能

deepagents-langchain 提供了三大核心能力，使其能够处理复杂的长周期任务：

1.  **规划与任务分解**：通过内置的 `write_todos` 工具，代理能够将复杂任务分解为离散的步骤，跟踪进度，并根据新信息调整计划。
2.  **上下文管理**：通过 `ls`、`read_file`、`write_file`、`edit_file`、`glob`、`grep` 等文件系统工具，代理可以将大量上下文卸载到内存中，防止上下文窗口溢出。
3.  **子代理生成**：通过内置的 `task` 工具，主代理可以生成专门的子代理以实现上下文隔离。这使得主代理的上下文保持简洁，同时仍能深入处理特定的子任务。

**Section sources**
- [libs/deepagents/README.md](file://libs/deepagents/README.md#L84-L94)

## 安装与配置

### 安装

您可以使用 `pip` 或推荐的 `uv` 工具来安装 deepagents。

**使用 pip 安装：**
```bash
pip install deepagents tavily-python
```

**使用 uv 安装（推荐）：**
```bash
uv add deepagents tavily-python
```

**Section sources**
- [README.md](file://README.md#L17-L19)

### API 密钥设置

要使用网络搜索等工具，您需要设置 `TAVILY_API_KEY` 环境变量。您可以在 [Tavily 官网](https://www.tavily.com/) 获取 API 密钥。

```python
import os
# 确保在环境中设置了 TAVILY_API_KEY
os.environ["TAVILY_API_KEY"] = "your_api_key_here"
```

**Section sources**
- [README.md](file://README.md#L21-L22)

## 基础使用

创建深度代理的核心是 `create_deep_agent` 函数。该函数返回一个编译后的 LangGraph StateGraph，因此您可以像使用任何 LangGraph 代理一样使用它，支持流式传输、人机协作、记忆和 Studio。

### 基本示例

以下代码展示了如何创建一个能够进行研究并撰写报告的深度代理：

```python
import os
from deepagents import create_deep_agent
from tavily import TavilyClient

# 初始化 Tavily 客户端
tavily_client = TavilyClient(api_key=os.environ["TAVILY_API_KEY"])

# 定义一个网络搜索工具
def internet_search(query: str, max_results: int = 5):
    """运行网络搜索"""
    return tavily_client.search(query, max_results=max_results)

# 创建深度代理
agent = create_deep_agent(
    tools=[internet_search],
    system_prompt="进行研究并撰写一份精炼的报告。",
)

# 调用代理
result = agent.invoke({"messages": [{"role": "user", "content": "什么是 LangGraph？"}]})
```

**Section sources**
- [README.md](file://README.md#L23-L39)

### 自定义模型

您可以使用 `model` 参数自定义代理所使用的模型。

```python
from langchain.chat_models import init_chat_model
from deepagents import create_deep_agent

# 使用 OpenAI 的 GPT-4o 模型
model = init_chat_model("openai:gpt-4o")
agent = create_deep_agent(model=model)
```

**Section sources**
- [README.md](file://README.md#L51-L58)

### 子代理委派

您可以配置自定义的子代理，以便主代理将工作委派给它们。

```python
# 定义一个研究子代理
research_subagent = {
    "name": "research-agent",
    "description": "用于研究深入问题",
    "prompt": "你是一位专家研究员",
    "tools": [internet_search],
    "model": "openai:gpt-4o",  # 可选，不指定则使用主代理模型
}

# 在创建主代理时传入子代理
agent = create_deep_agent(subagents=[research_subagent])
```

**Section sources**
- [README.md](file://README.md#L143-L153)

## CLI使用指南

deepagents-cli 是一个在终端中运行的开源编码助手，类似于 Claude Code。

### 安装 CLI

```bash
# 使用 pip 安装
pip install deepagents-cli

# 或使用 uv 安装（推荐）
uv pip install deepagents-cli
```

**Section sources**
- [libs/deepagents-cli/README.md](file://libs/deepagents-cli/README.md#L17-L28)

### 运行 CLI

安装后，您可以在终端中直接运行 `deepagents` 命令来启动代理。

```bash
deepagents
```

您还可以使用各种选项来配置代理：

```bash
# 使用特定的代理配置
deepagents --agent mybot

# 自动批准工具使用（跳过人机协作提示）
deepagents --auto-approve

# 在远程沙箱中执行代码
deepagents --sandbox modal        # 或 runloop, daytona
deepagents --sandbox-id dbx_123   # 复用现有的沙箱
```

**Section sources**
- [libs/deepagents-cli/README.md](file://libs/deepagents-cli/README.md#L31-L52)

## 中间件与后端

### 内置中间件

deepagents 使用中间件来实现其核心功能。以下是默认包含的中间件：

| 中间件 | 用途 |
|--------|------|
| **TodoListMiddleware** | 任务规划和进度跟踪 |
| **FilesystemMiddleware** | 文件操作和上下文卸载（自动保存大结果） |
| **SubAgentMiddleware** | 委派任务给隔离的子代理 |
| **SummarizationMiddleware** | 当上下文超过 170k tokens 时自动摘要 |
| **AnthropicPromptCachingMiddleware** | 缓存系统提示以降低成本（仅限 Anthropic） |
| **PatchToolCallsMiddleware** | 修复中断后的悬空工具调用 |
| **HumanInTheLoopMiddleware** | 在执行配置的工具前暂停以等待人工批准 |

**Section sources**
- [README.md](file://README.md#L279-L287)

### 后端

deepagents 使用可插拔的后端来控制文件系统操作的工作方式。默认情况下，文件存储在代理的临时状态中。

```python
from deepagents import create_deep_agent
from deepagents.backends import FilesystemBackend

# 配置文件系统后端，将文件存储在指定目录
agent = create_deep_agent(
    backend=FilesystemBackend(root_dir="/path/to/project"),
)
```

可用的后端包括：
- **StateBackend** (默认): 存储在代理状态中的临时文件
- **FilesystemBackend**: 在根目录下进行真实磁盘操作
- **StoreBackend**: 使用 LangGraph Store 进行持久化存储
- **CompositeBackend**: 将不同路径路由到不同后端

**Section sources**
- [README.md](file://README.md#L204-L220)

## 常见问题

### 依赖安装失败

如果在安装 CLI 时遇到依赖缺失的问题，请确保安装了所有可选依赖：

```bash
pip install 'deepagents[cli]'
```

**Section sources**
- [libs/deepagents-cli/main.py](file://libs/deepagents-cli/main.py#L67-L69)

### API 密钥配置错误

如果网络搜索功能被禁用，请检查 `TAVILY_API_KEY` 是否已正确设置：

```bash
# 在终端中设置环境变量
export TAVILY_API_KEY=your_api_key_here

# 或将其添加到 .env 文件中
echo "TAVILY_API_KEY=your_api_key_here" >> .env
```

**Section sources**
- [libs/deepagents-cli/main.py](file://libs/deepagents-cli/main.py#L180-L188)

## 高级主题

对于更高级的用法，如使用 MCP 工具、自定义中间件或实现长期记忆，请参考官方文档。

**Section sources**
- [README.md](file://README.md#L43-L249)